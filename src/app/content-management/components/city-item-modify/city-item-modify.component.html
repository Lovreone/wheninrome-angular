<!-- TODO: Clean-up unnecessary comments when finished -->
<!-- Pure CSS Loader https://loading.io/css/ -->
<div *ngIf="isLoading" class="lds-default">
    <div></div><div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div><div></div>
</div>

<form *ngIf="!isLoading" [formGroup]="cityForm">
  
    <p *ngIf="city?.createdAt">Created: {{ city.createdAt | date:'fullDate' }}</p>
    <p *ngIf="city?.modifiedAt">Modified: {{ city.modifiedAt | date:'fullDate' }}</p>
        
    <!-- NAME field -->
    <label for="name">City name*: </label><br>
    <input type="text" id="name" required 
        formControlName="name"
        [ngClass]="{ 'field-invalid': isFieldInvalid('name') }"><br>
    <!-- NAME field validation messages -->
    <div *ngIf="isFieldInvalid('name')" class="error-message">
        <div *ngIf="name?.errors?.required">
            City name is required.
        </div>
        <div *ngIf="name?.errors?.minlength">
            City name must be at least {{ name?.errors?.minlength?.requiredLength }} characters long.
        </div>
    </div><br>

    <!-- SLUG field -->
    <label for="slug">City slug*: </label><br>
    <input type="text" id="slug"
        formControlName="slug"
        [ngClass]="{ 'field-invalid': isFieldInvalid('slug') }">
    <!-- SLUG field validation messages -->
    <div *ngIf="isFieldInvalid('slug')" class="error-message">
        <div *ngIf="slug?.errors?.required">
            City slug is required.
        </div>
        <div *ngIf="slug?.errors?.minlength">
            City slug must be at least {{ slug?.errors?.minlength?.requiredLength }} characters long.
        </div>
    </div><br>

    <!-- VISIBILITY field -->
    <p>Visibility options:</p>
    <div>
        <input type="radio" id="public" name="isActive" [value]="true"
            formControlName="isActive"                >
        <label for="public">Public</label>
    </div>
    <div>
        <input type="radio" id="private" name="isActive" [value]="false"
            formControlName="isActive">
        <label for="private">Private</label>
    </div>
    <!-- VISIBILITY field validation messages -->
    <div *ngIf="isFieldInvalid('isActive')" class="error-message">
        <div *ngIf="isActive?.errors?.required">
            Visibility options selection is required.
        </div>
    </div><br>

    <!-- COUNTRY field -->
    <label for="country">Country: </label><br>
    <input type="text" id="country"
        formControlName="country"
        [ngClass]="{ 'field-invalid': isFieldInvalid('country') }"><br>
    <!-- COUNTRY field validation messages -->
    <div *ngIf="isFieldInvalid('country')" class="error-message">
        <div *ngIf="country?.errors?.minlength">
            Country must be at least {{ country?.errors?.minlength?.requiredLength }} characters long.
        </div>
    </div><br>

    <!-- TODO: Rework to be an Image upload element later -->
    <!-- IMAGE field -->
    <label for="image">Image: </label><br>
    <input type="text" id="image"
        formControlName="image"
        [ngClass]="{ 'field-invalid': isFieldInvalid('image') }"><br><br> 

    <!-- DESCRIPTION field -->
    <label for="description">City description: </label><br>
    <textarea id="description" rows="3"
        formControlName="description"></textarea><br><br>

    <button (click)="saveCity()" [disabled]="!(cityForm.valid && cityForm.dirty)">
        {{ isNew ? 'Create City' : 'Update City' }}
    </button>

</form>

<div *ngIf="serverErrors && serverErrors.length">
    <p>Error messages:</p>
    <ul>
        <!-- FIXME: Use class instead of style -->
        <li *ngFor="let error of serverErrors" style="color:red">{{ error }}</li> 
    </ul>
</div>